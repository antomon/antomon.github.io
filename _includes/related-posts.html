{% if page.categories and page.type == "post" %}
<section class="related-posts">
  <h2>Related Posts</h2>
  <div class="related-posts-grid">
    {% for post in collections.posts | where("categories", "intersect", page.categories) | sort(attribute="date", order="desc") | slice(3) %}
      {% if post.path != page.path %}
        <div class="related-post-card">
          <a href="{{ post.path }}">
            {% if post.image %}
              <img src="{{ post.image }}" alt="{{ post.title }}">
            {% else %}
              <img src="/default-thumbnail.jpg" alt="{{ post.title }}">
            {% endif %}
            <h4>{{ post.title }}</h4>
          </a>
        </div>
      {% endif %}
    {% endfor %}
  </div>
</section>
{% endif %}

